# å¿«é€Ÿåƒè€ƒï¼šæ¥­å‹™å¯¦é«”å»ºç«‹æº–å‚™åº¦

> **ä¸€å¥è©±ç¸½çµ**: å¯ä»¥é–‹å§‹ï¼Œä½†å¿…é ˆå…ˆèŠ± 1-2 é€±é‡æ§‹æ¶æ§‹ä»¥ç¬¦åˆ Task.md åŸå‰‡ã€‚

---

## ğŸ“Š æº–å‚™åº¦è©•åˆ†

| é …ç›® | åˆ†æ•¸ | ç‹€æ…‹ |
|------|------|------|
| **Core Layer** | 100% | âœ… å®Œç¾ |
| **Infrastructure Layer** | 100% | âœ… å®Œç¾ |
| **Platform Layer** | 30% | âš ï¸ éª¨æ¶å­˜åœ¨ï¼Œé‚è¼¯æœªå®Œæˆ |
| **Task Domain** | 20% | âŒ é•åæ¶æ§‹åŸå‰‡ |
| **Event Sourcing** | 85% | âš ï¸ ç¼º Projection Engine |
| **æ•´é«”** | **65%** | âš ï¸ **C+ ç´š** |

---

## âœ… å„ªç§€ä¹‹è™•

### 1. Core Layer - å …å¯¦åŸºç¤ (100%)

```
âœ… Result<T, E> éŒ¯èª¤è™•ç†æ¨¡å¼
âœ… ErrorFactory çµ±ä¸€éŒ¯èª¤ç®¡ç†
âœ… Event System å®Œæ•´å¯¦ä½œ
âœ… Causality Tracking æ©Ÿåˆ¶
âœ… Policy Engine æˆæ¬Šæ²»ç†
âœ… Audit Trail å¯©è¨ˆè¿½è¹¤
```

### 2. Infrastructure Layer - é›™è³‡æ–™åº«æ”¯æ´ (100%)

```
âœ… Firebase + Supabase å®Œæ•´å¯¦ä½œ
âœ… Event Store å®Œå…¨å°±ç·’
âœ… causedBy å› æœéˆæ”¯æ´
âœ… correlationId æµç¨‹è¿½è¹¤
âœ… Event Versioning ç‰ˆæœ¬æ§åˆ¶
```

---

## âŒ é—œéµå•é¡Œ

### å•é¡Œ 1: é•å Task.md æ¶æ§‹åŸå‰‡ (æœ€åš´é‡)

**Task.md æ˜ç¢ºè¦å®š**:
> Task æ˜¯å”¯ä¸€æ¥­å‹™å¯¦é«”

**ç¾æ³**:
```
features/domains/
â”œâ”€â”€ activity/     âŒ ä¸æ‡‰å­˜åœ¨
â”œâ”€â”€ attachment/   âŒ æ‡‰ç‚º Task çš„é™„ä»¶äº‹ä»¶
â”œâ”€â”€ comment/      âŒ æ‡‰ç‚º Task çš„è©•è«–äº‹ä»¶
â”œâ”€â”€ discussion/   âŒ æ‡‰ç‚º Task çš„è¨è«–äº‹ä»¶
â”œâ”€â”€ issue/        âŒ æ‡‰åˆä½µåˆ° Task
â”œâ”€â”€ task/         âš ï¸ å­˜åœ¨ä½†ä¸å®Œæ•´
â””â”€â”€ user/         âŒ æ‡‰åœ¨ Platform Layer
```

**å½±éŸ¿**: æ¶æ§‹ä¸ä¸€è‡´ï¼ŒæŠ€è¡“å‚µç´¯ç©ï¼Œæœªä¾†é‡æ§‹æˆæœ¬æ›´é«˜

### å•é¡Œ 2: ç¼ºå°‘ Projection Engine (é˜»å¡)

**Event Sourcing æ ¸å¿ƒåŸå‰‡**:
> State = replay(events)

**ç¾æ³**: æœ‰ Event Storeï¼Œæ²’æœ‰ Projection Engine

**å½±éŸ¿**: ç„¡æ³•å¾ Events é‡å»ºç‹€æ…‹ï¼Œç„¡æ³•å¯¦ç¾å¤šè¦–åœ–æ¶æ§‹

### å•é¡Œ 3: ç¼ºå°‘ Decision Layer (æ¶æ§‹ä¸å®Œæ•´)

**Causality-Driven æ ¸å¿ƒ**:
> æ‰€æœ‰æ±ºç­–éƒ½æ˜¯ç´”å‡½æ•¸

**ç¾æ³**: æ²’æœ‰ `decisions/` å±¤

**å½±éŸ¿**: æ¥­å‹™è¦å‰‡æ•£è½å„è™•ï¼Œç„¡æ³•ä¿è­‰ç¢ºå®šæ€§

---

## ğŸ¯ å¿…é ˆå…ˆåšçš„äº‹ (Week 1-2)

### Week 1

**1. å»ºç«‹ Projection Engine** (æœ€é«˜å„ªå…ˆç´š)

```typescript
// src/app/core/projection/projection-engine.interface.ts
export interface ProjectionEngine {
  // å¾ Events é‡å»ºç‹€æ…‹
  project<T>(events: StoredEvent[]): T;
  
  // Snapshot å„ªåŒ–
  getSnapshot<T>(aggregateId: string): Promise<T | null>;
  createSnapshot<T>(aggregateId: string, state: T): Promise<void>;
  
  // Event Replay
  replay(aggregateId: string, toVersion?: number): Promise<void>;
}
```

**2. å‰µå»º ADR (æ¶æ§‹æ±ºç­–è¨˜éŒ„)**

- ADR-001: Task ä½œç‚ºå”¯ä¸€æ¥­å‹™å¯¦é«”
- ADR-002: Event Sourcing + Projection æ¶æ§‹

**3. è¦åŠƒé‡æ§‹ç´°ç¯€**

- åˆ—å‡ºæ‰€æœ‰å—å½±éŸ¿çš„æª”æ¡ˆ
- è¦åŠƒæ¸¬è©¦ç­–ç•¥
- åˆ¶å®šå›æ»¾æ–¹æ¡ˆ

### Week 2

**4. é–‹å§‹é‡æ§‹ features/domains/**

```bash
# æ­¥é©Ÿ 1: åˆªé™¤é•è¦ç›®éŒ„
rm -rf features/domains/activity/
rm -rf features/domains/attachment/
rm -rf features/domains/comment/
rm -rf features/domains/discussion/

# æ­¥é©Ÿ 2: ç§»å‹• user/ åˆ° Platform
mv features/domains/user/ platform/entities/user/

# æ­¥é©Ÿ 3: åˆä½µ issue/ åˆ° task/
# (éœ€è¦ä»£ç¢¼é·ç§»)

# æ­¥é©Ÿ 4: é‡æ§‹ task/ çµæ§‹
features/domains/task/
â”œâ”€â”€ events/        # æ–°å¢
â”œâ”€â”€ decisions/     # æ–°å¢
â”œâ”€â”€ projections/   # æ–°å¢
â”œâ”€â”€ processes/     # æ–°å¢
â”œâ”€â”€ commands/      # æ–°å¢
â”œâ”€â”€ models/        # æ–°å¢
â””â”€â”€ ui/            # æ–°å¢
```

**5. å¯¦ä½œ Snapshot æ©Ÿåˆ¶**

**6. å»ºç«‹ Task Events éª¨æ¶**

---

## ğŸš€ ä¹‹å¾Œçš„å¯¦ä½œé †åº

### Phase 2: Task Domain (Week 3-6)

```
Week 3-4: Task Events + Decisions
- task.events.ts (10 events)
- task.decisions.ts (ç´”å‡½æ•¸)
- task-comment.events.ts
- comment.decisions.ts
- task-discussion.events.ts
- discussion.decisions.ts

Week 4-5: Task Projections + Processes
- task-list.projection.ts (åˆ—è¡¨è¦–åœ–)
- task-board.projection.ts (çœ‹æ¿è¦–åœ–)
- task-why.projection.ts (Whyè¦–åœ–)
- task-timeline.projection.ts (æ™‚é–“ç·š)
- task-lifecycle.process.ts (Saga)

Week 5-6: Task Commands + Models + UI
- task.commands.ts
- comment.commands.ts
- task.model.ts (Read Model)
- Task UI Components (50 files)
```

**ç”¢å‡º**: ~100 files

### Phase 3: Platform Layer (Week 6-9)

```
å®Œå–„æ¯å€‹ Platform Entity:
- User (25 files)
- Organization (25 files)
- Team (25 files)
- Collaborator (25 files)
- Bot (25 files)

å¯¦ä½œ Platform Processes:
- collaboration.process.ts
- onboarding.process.ts
- team-formation.process.ts

å¯¦ä½œ Platform UI:
- User List, Org Dashboard, Team View ç­‰
```

**ç”¢å‡º**: ~170 files

### Phase 4: æ•´åˆæ¸¬è©¦ (Week 10-12)

```
- Platform â†” Task æ•´åˆæ¸¬è©¦
- E2E æ¸¬è©¦æ“´å±•
- Dev Tools æ›´æ–°
- æ–‡ä»¶å®Œå–„
```

**ç”¢å‡º**: ~50 files

---

## ğŸ“ æ­£ç¢ºçš„ Event Sourcing æµç¨‹

### å‘½ä»¤ â†’ æ±ºç­– â†’ äº‹ä»¶ â†’ æŠ•å½±

```
1. UI ç™¼é€ Command
   CreateTaskCommand { title, description, assignedTo }

2. Decision å‡½æ•¸é©—è­‰ (ç´”å‡½æ•¸)
   decideCreateTask(command, events)
   â†’ Result<TaskCreatedEvent, Error>

3. Event å­˜å„²
   eventStore.append(TaskCreatedEvent)
   â†’ causedBy, correlationId, timestamp

4. Event ç™¼å¸ƒ
   eventBus.publish(TaskCreatedEvent)

5. Projection æ›´æ–°
   taskListProjection.apply(event)
   â†’ æ›´æ–° Read Model

6. UI æŸ¥è©¢
   taskListProjection.query()
   â†’ é¡¯ç¤ºæœ€æ–°ç‹€æ…‹
```

### ç¦æ­¢çš„æ¨¡å¼

```typescript
// âŒ éŒ¯èª¤ - CRUD æ¨¡å¼
await taskRepository.update(taskId, { status: 'Completed' });

// âœ… æ­£ç¢º - Event Sourcing
const event: TaskCompletedEvent = {
  type: 'TaskCompleted',
  taskId: taskId,
  completedAt: new Date(),
  causedBy: [lastEventId]
};
await eventStore.append(event);
```

---

## âš ï¸ é¢¨éšªæé†’

### å¦‚æœè·³éé‡æ§‹ç›´æ¥å»ºç«‹æ–°å¯¦é«”

**æœƒç™¼ç”Ÿä»€éº¼**:
1. âŒ æ¶æ§‹ä¸ä¸€è‡´ (ä¸€å¥—æ–°çš„ï¼Œä¸€å¥—èˆŠçš„)
2. âŒ é•å Task.md åŸå‰‡
3. âŒ æŠ€è¡“å‚µè¶Šä¾†è¶Šé‡
4. âŒ åœ˜éšŠå°æ¶æ§‹ç†è§£æ··äº‚
5. âŒ æœªä¾†é‡æ§‹æˆæœ¬æŒ‡æ•¸å¢é•·

**æ­£ç¢ºåšæ³•**:
1. âœ… å…ˆèŠ± 1-2 é€±é‡æ§‹
2. âœ… çµ±ä¸€æ¶æ§‹åŸå‰‡
3. âœ… æ¸…é™¤æŠ€è¡“å‚µ
4. âœ… ç„¶å¾Œé–‹å§‹å»ºç«‹æ–°å¯¦é«”

---

## ğŸ“Š ç¸½æ™‚ç¨‹ä¼°ç®—

| éšæ®µ | æ™‚é–“ | æª”æ¡ˆæ•¸ | é‡é» |
|------|------|--------|------|
| Phase 1: é‡æ§‹ | 1-2 é€± | ~50 | æ¶æ§‹åˆè¦ |
| Phase 2: Task Domain | 2-3 é€± | ~100 | æ ¸å¿ƒæ¥­å‹™ |
| Phase 3: Platform | 2-3 é€± | ~170 | å¤šç§Ÿæˆ¶ |
| Phase 4: æ•´åˆ | 1-2 é€± | ~50 | æ¸¬è©¦æ–‡ä»¶ |
| **ç¸½è¨ˆ** | **6-10 é€±** | **~370** | |

---

## âœ… æˆåŠŸæ¨™æº–

### æ¶æ§‹åˆè¦æ€§æª¢æŸ¥æ¸…å–®

- [ ] Task æ˜¯å”¯ä¸€æ¥­å‹™å¯¦é«”
- [ ] Events æ˜¯å”¯ä¸€äº‹å¯¦ä¾†æº
- [ ] æ‰€æœ‰ Decision éƒ½æ˜¯ç´”å‡½æ•¸
- [ ] State = replay(events)
- [ ] å®Œæ•´çš„ Causality è¿½è¹¤ (causedBy)
- [ ] å¤šè¦–åœ–é€é Projection å¯¦ç¾
- [ ] Process Manager è™•ç†è·¨å¯¦é«”å”èª¿
- [ ] æ²’æœ‰ CRUD ç›´æ¥ä¿®æ”¹ç‹€æ…‹
- [ ] æ²’æœ‰ throw Error (ä½¿ç”¨ Result)
- [ ] æ²’æœ‰ Domain ä¾è³´ Infrastructure

### Event Sourcing æª¢æŸ¥æ¸…å–®

- [ ] Event Store å®Œæ•´å¯¦ä½œ
- [ ] Projection Engine å»ºç«‹
- [ ] Snapshot æ©Ÿåˆ¶å„ªåŒ–
- [ ] Event Replay åŠŸèƒ½
- [ ] Event Versioning ç­–ç•¥
- [ ] Read Model Updater
- [ ] Event Bus è¨‚é–±æ©Ÿåˆ¶
- [ ] Saga/Process Manager

### æ¸¬è©¦è¦†è“‹æª¢æŸ¥æ¸…å–®

- [ ] Decision å±¤ Unit Tests (>90%)
- [ ] Projection å±¤ Unit Tests (>90%)
- [ ] Event Store Integration Tests
- [ ] Process Manager Integration Tests
- [ ] Platform â†” Task E2E Tests

---

## ğŸ’¬ è¨è«–å•é¡Œ

### æŠ€è¡“å•é¡Œ

1. **é‡æ§‹æ™‚ç¨‹**: 2 é€±å¤ å—ï¼Ÿé‚„æ˜¯éœ€è¦æ›´å¤šæ™‚é–“ï¼Ÿ
2. **ç¾æœ‰åŠŸèƒ½**: `issue/`, `comment/`, `discussion/` æœ‰ä¸Šç·šå—ï¼Ÿ
3. **æ•ˆèƒ½éœ€æ±‚**: Projection Engine æœ‰ç‰¹æ®Šæ•ˆèƒ½è¦æ±‚å—ï¼Ÿ
4. **æ¸¬è©¦ç­–ç•¥**: é‡æ§‹å‰éœ€è¦å¤šå°‘æ¸¬è©¦è¦†è“‹ï¼Ÿ

### å„ªå…ˆç´šå•é¡Œ

1. **Platform vs Task**: Platform Layer å¯ä»¥å»¶å¾Œåˆ° Task å®Œæˆå¾Œå—ï¼Ÿ
2. **UI å„ªå…ˆ**: Task UI æ˜¯å¦æ¯” Platform UI æ›´é‡è¦ï¼Ÿ
3. **Process Manager**: Saga çš„å„ªå…ˆç´šå¦‚ä½•ï¼Ÿ

### è³‡æºå•é¡Œ

1. **é–‹ç™¼äººåŠ›**: æœ‰å¹¾å€‹é–‹ç™¼è€…å¯ä»¥æŠ•å…¥ï¼Ÿ
2. **Code Review**: é‡æ§‹éœ€è¦å¤šå°‘ Review è³‡æºï¼Ÿ
3. **æ¸¬è©¦è³‡æº**: æœ‰å°ˆé–€çš„æ¸¬è©¦äººå“¡å—ï¼Ÿ

---

## ğŸ“š è©³ç´°æ–‡ä»¶

1. **business-entity-readiness-analysis.md** - å®Œæ•´è‹±æ–‡æŠ€è¡“åˆ†æ
2. **æº–å‚™åº¦åˆ†æè¨è«–.md** - ç¹é«”ä¸­æ–‡è©³ç´°è¨è«–
3. **æ¶æ§‹å°æ¯”èˆ‡é‡æ§‹è·¯å¾‘.md** - æ¶æ§‹å°æ¯”èˆ‡è¦–è¦ºåŒ–

---

**æœ€å¾Œæ›´æ–°**: 2025-12-31  
**ç‰ˆæœ¬**: 1.0  
**ç‹€æ…‹**: âœ… åˆ†æå®Œæˆï¼Œç­‰å¾…è¨è«–
