# old/src-old åŠŸèƒ½æå–å»ºè­°æ‘˜è¦

**æ—¥æœŸ**: 2025-12-30  
**å®Œæ•´åˆ†æ**: è«‹åƒè€ƒ [OLD_SOURCE_FEATURE_EXTRACTION.md](./OLD_SOURCE_FEATURE_EXTRACTION.md)

---

## å¿«é€Ÿæ±ºç­–æŒ‡å—

### ğŸ”´ å»ºè­°ç«‹å³æå– (é«˜åƒ¹å€¼ã€ä½é¢¨éšª)

#### 1. async-state.ts - ç•°æ­¥ç‹€æ…‹ç®¡ç†å·¥å…·
- **ä½ç½®**: `old/src-old/app/shared/utils/async-state.ts`
- **ç›®æ¨™**: `src/app/shared-ui/utils/async-state.ts`
- **åƒ¹å€¼**: â­â­â­â­â­ å®Œç¾å¥‘åˆ Angular 20 Signals
- **é¢¨éšª**: âœ… æ¥µä½ (å¯ç›´æ¥ä½¿ç”¨)
- **å·¥ä½œé‡**: 5 åˆ†é˜

```typescript
// ä½¿ç”¨ç¯„ä¾‹
const usersState = createAsyncState<User[]>([]);
await usersState.load(userService.getUsers());

// åœ¨æ¨¡æ¿ä¸­
@if (usersState.loading()) {
  <nz-spin />
} @else {
  <div>{{ usersState.data() }}</div>
}
```

#### 2. Audit System - å¯©è¨ˆæ—¥èªŒç³»çµ±
- **åƒ¹å€¼**: â­â­â­â­â­ æä¾›å®Œæ•´çš„å¯©è¨ˆè¿½è¹¤
- **é¢¨éšª**: âš ï¸ ä½ (éœ€è¦æ•´åˆ Result æ¨¡å¼)
- **å·¥ä½œé‡**: 1-2 å¤©

**æå–æª”æ¡ˆ**:
```
old/src-old/app/core/audit/
â”œâ”€â”€ audit-event.model.ts          â†’ observability/audit/models/
â”œâ”€â”€ audit-log.service.ts          â†’ observability/audit/services/
â”œâ”€â”€ auditable.decorator.ts        â†’ observability/audit/decorators/
â””â”€â”€ audit-log.consumer.ts         â†’ observability/audit/consumers/
```

**åŠŸèƒ½**:
- âœ… è‡ªå‹•è¨˜éŒ„é‡è¦æ“ä½œ
- âœ… ä½¿ç”¨ @Auditable è£é£¾å™¨
- âœ… èˆ‡äº‹ä»¶ç³»çµ±æ•´åˆ
- âœ… æ”¯æ´æŸ¥è©¢å¯©è¨ˆæ­·å²

#### 3. Event Bus Resilience - äº‹ä»¶å½ˆæ€§è™•ç†
- **åƒ¹å€¼**: â­â­â­â­â­ æä¾›é‡è©¦å’ŒéŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶
- **é¢¨éšª**: âš ï¸ ä¸­ (éœ€è¦æ•´åˆç•¶å‰äº‹ä»¶ç³»çµ±)
- **å·¥ä½œé‡**: 2-3 å¤©

**æå–æª”æ¡ˆ**:
```
old/src-old/app/core/event-bus/lifecycle/resilience/
â”œâ”€â”€ retry-manager.service.ts      â†’ event-system/resilience/
â”œâ”€â”€ dead-letter-queue.service.ts  â†’ event-system/resilience/
â”œâ”€â”€ retry.decorator.ts            â†’ event-system/resilience/
â””â”€â”€ retry-policy.interface.ts     â†’ event-system/resilience/
```

**åŠŸèƒ½**:
- âœ… è‡ªå‹•é‡è©¦å¤±æ•—çš„äº‹ä»¶
- âœ… æ­»ä¿¡éšŠåˆ—è™•ç†
- âœ… å¯é…ç½®çš„é‡è©¦ç­–ç•¥
- âœ… ä½¿ç”¨ @Retry è£é£¾å™¨

#### 4. Permission Guard - æ¬Šé™è·¯ç”±å®ˆè¡›
- **åƒ¹å€¼**: â­â­â­â­â­ å®Œå–„çš„æ¬Šé™æ§åˆ¶
- **é¢¨éšª**: âš ï¸ ä¸­ (éœ€è¦æ•´åˆ Identity ç³»çµ±)
- **å·¥ä½œé‡**: 1 å¤©

**æå–æª”æ¡ˆ**:
```
old/src-old/app/core/guards/permission.guard.ts
  â†’ src/app/core/guards/permission.guard.ts
```

#### 5. Refresh Token Interceptor - Token è‡ªå‹•åˆ·æ–°
- **åƒ¹å€¼**: â­â­â­â­â­ æ”¹å–„ä½¿ç”¨è€…é«”é©—
- **é¢¨éšª**: âš ï¸ ä¸­ (éœ€è¦æ•´åˆèªè­‰ç³»çµ±)
- **å·¥ä½œé‡**: 1-2 å¤©

**æå–æª”æ¡ˆ**:
```
old/src-old/app/core/interceptors/refresh-token.interceptor.ts
  â†’ src/app/infrastructure/http/interceptors/refresh-token.interceptor.ts
```

---

### ğŸŸ¡ å»ºè­°è©•ä¼°å¾Œæå– (ä¸­åƒ¹å€¼ã€éœ€è¦è©•ä¼°)

#### 6. Multi-Tenant System - å¤šç§Ÿæˆ¶ç³»çµ±
- **åƒ¹å€¼**: â­â­â­â­ (å¦‚æœéœ€è¦å¤šç§Ÿæˆ¶åŠŸèƒ½)
- **é¢¨éšª**: âš ï¸ ä¸­é«˜
- **å·¥ä½œé‡**: 3-5 å¤©
- **æ±ºç­–é»**: å°ˆæ¡ˆæ˜¯å¦éœ€è¦å¤šç§Ÿæˆ¶æ”¯æ´ï¼Ÿ

**æå–æª”æ¡ˆ**:
```
old/src-old/app/core/
â”œâ”€â”€ models/multi-tenant-types.model.ts
â”œâ”€â”€ models/organization.model.ts
â”œâ”€â”€ services/tenant/tenant-context.service.ts
â”œâ”€â”€ guards/tenant.guard.ts
â””â”€â”€ interceptors/context.interceptor.ts
```

#### 7. Event Persistence - äº‹ä»¶æŒä¹…åŒ–
- **åƒ¹å€¼**: â­â­â­â­ (å¦‚æœéœ€è¦äº‹ä»¶æº¯æº)
- **é¢¨éšª**: âš ï¸ ä¸­
- **å·¥ä½œé‡**: 2-3 å¤©

**æå–æª”æ¡ˆ**:
```
old/src-old/app/core/event-bus/lifecycle/persistence/
â”œâ”€â”€ event-store.interface.ts
â”œâ”€â”€ event-replay.service.ts
â””â”€â”€ implementations/storage/
```

#### 8. Policy Validation Service - æ”¿ç­–é©—è­‰
- **åƒ¹å€¼**: â­â­â­â­
- **é¢¨éšª**: âš ï¸ ä¸­
- **å·¥ä½œé‡**: 2-3 å¤©

**æå–æª”æ¡ˆ**:
```
old/src-old/app/core/three-layer-model/services/
â””â”€â”€ policy-validation.service.ts
```

#### 9. Testing Utilities - æ¸¬è©¦å·¥å…·
- **åƒ¹å€¼**: â­â­â­â­
- **é¢¨éšª**: âœ… ä½
- **å·¥ä½œé‡**: 1 å¤©

**æå–æª”æ¡ˆ**:
```
old/src-old/app/core/event-bus/lifecycle/testing/
â”œâ”€â”€ mock-event-bus.ts
â”œâ”€â”€ test-event.ts
â””â”€â”€ event-bus-test.utils.ts
```

---

### ğŸŸ¢ å¯é¸æå– (ä½å„ªå…ˆç´š)

#### 10. Shared Components - å…±äº« UI å…ƒä»¶
- **åƒ¹å€¼**: â­â­â­ (è¦–æ¥­å‹™éœ€æ±‚)
- **æ±ºç­–é»**: æ˜¯å¦éœ€è¦é€™äº›ç‰¹å®šçš„æ¥­å‹™å…ƒä»¶ï¼Ÿ

**å¯ç”¨å…ƒä»¶**:
- Breadcrumb éºµåŒ…å±‘å°èˆª
- Organization Management çµ„ç¹”ç®¡ç†
- Team Management åœ˜éšŠç®¡ç†

#### 11. Firebase Functions - é›²ç«¯å‡½æ•¸
- **åƒ¹å€¼**: â­â­â­ (è¦–å¾Œç«¯éœ€æ±‚)
- **æ±ºç­–é»**: æ˜¯å¦éœ€è¦å¾Œç«¯è™•ç†é‚è¼¯ï¼Ÿ

**å¯ç”¨ Functions**:
- functions-shared (å…±äº«å·¥å…·)
- functions-ai-document (OCR æ–‡ä»¶è™•ç†)
- functions-auth (èªè­‰è™•ç†)

---

## ä¸‰éšæ®µæå–è¨ˆåŠƒ

### Phase 1: å¿«é€Ÿå‹åˆ© (Week 1)

**ç›®æ¨™**: æå–é›¶é¢¨éšªã€é«˜åƒ¹å€¼çš„å·¥å…·

1. âœ… async-state.ts (5 åˆ†é˜)
2. âœ… Audit System åŸºç¤ (2 å¤©)
3. âœ… Testing Utilities (1 å¤©)

**é æœŸæˆæœ**:
- æ”¹å–„ç•°æ­¥ç‹€æ…‹ç®¡ç†
- åŸºç¤å¯©è¨ˆèƒ½åŠ›
- æ›´å¥½çš„æ¸¬è©¦å·¥å…·

### Phase 2: æ ¸å¿ƒå¢å¼· (Week 2-3)

**ç›®æ¨™**: æå–æ ¸å¿ƒç³»çµ±å¢å¼·åŠŸèƒ½

1. âœ… Event Bus Resilience (2-3 å¤©)
2. âœ… Permission Guard (1 å¤©)
3. âœ… Refresh Token Interceptor (1-2 å¤©)
4. â¬œ Event Persistence (2-3 å¤©ï¼Œå¯é¸)

**é æœŸæˆæœ**:
- æ›´å¼·å¤§çš„äº‹ä»¶è™•ç†
- å®Œå–„çš„æ¬Šé™æ§åˆ¶
- æ›´å¥½çš„ä½¿ç”¨è€…é«”é©—

### Phase 3: é€²éšåŠŸèƒ½ (Week 4+)

**ç›®æ¨™**: æ ¹æ“šå¯¦éš›éœ€æ±‚æå–é€²éšåŠŸèƒ½

1. â¬œ Multi-Tenant System (å¦‚éœ€è¦)
2. â¬œ Policy Validation (å¦‚éœ€è¦)
3. â¬œ Shared Components (ä¾æ¥­å‹™éœ€æ±‚)
4. â¬œ Firebase Functions (ä¾å¾Œç«¯éœ€æ±‚)

---

## é—œéµæ±ºç­–å•é¡Œ

åœ¨é–‹å§‹æå–å‰ï¼Œè«‹å›ç­”ä»¥ä¸‹å•é¡Œï¼š

### æ¥­å‹™éœ€æ±‚
1. â“ æ˜¯å¦éœ€è¦å¤šç§Ÿæˆ¶åŠŸèƒ½ï¼Ÿ
2. â“ æ˜¯å¦éœ€è¦å¯©è¨ˆè¿½è¹¤ï¼Ÿ
3. â“ æ˜¯å¦éœ€è¦äº‹ä»¶æº¯æºï¼Ÿ
4. â“ æ˜¯å¦éœ€è¦å¾Œç«¯è™•ç†é‚è¼¯ (Firebase Functions)ï¼Ÿ

### æŠ€è¡“éœ€æ±‚
1. â“ ç•¶å‰äº‹ä»¶ç³»çµ±æ˜¯å¦éœ€è¦å¢å¼·ï¼Ÿ
2. â“ æ˜¯å¦éœ€è¦æ›´å®Œå–„çš„æ¬Šé™æ§åˆ¶ï¼Ÿ
3. â“ æ˜¯å¦éœ€è¦è‡ªå‹• Token åˆ·æ–°ï¼Ÿ
4. â“ æ˜¯å¦éœ€è¦é‡è©¦å’ŒéŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶ï¼Ÿ

### è³‡æºé™åˆ¶
1. â“ å¯ç”¨çš„é–‹ç™¼æ™‚é–“ï¼Ÿ
2. â“ åœ˜éšŠå°èˆŠä»£ç¢¼çš„ç†Ÿæ‚‰ç¨‹åº¦ï¼Ÿ
3. â“ æ¸¬è©¦è³‡æºï¼Ÿ

---

## é¢¨éšªç®¡ç†

### å¸¸è¦‹é¢¨éšªåŠç·©è§£ç­–ç•¥

#### é¢¨éšª 1: ä¾è³´è¡çª
- **æ©Ÿç‡**: ä¸­
- **å½±éŸ¿**: ä¸­
- **ç·©è§£**: é€ä¸€æª¢æŸ¥å¥—ä»¶ç‰ˆæœ¬ï¼Œå¿…è¦æ™‚æ›´æ–°

#### é¢¨éšª 2: æ¶æ§‹ä¸åŒ¹é…
- **æ©Ÿç‡**: é«˜
- **å½±éŸ¿**: ä¸­é«˜
- **ç·©è§£**: å„ªå…ˆæå–ç¨ç«‹åŠŸèƒ½ï¼Œé¿å…å¼·è€¦åˆéƒ¨åˆ†

#### é¢¨éšª 3: æ¸¬è©¦ä¸è¶³
- **æ©Ÿç‡**: é«˜
- **å½±éŸ¿**: é«˜
- **ç·©è§£**: åŒæ™‚æå–æ¸¬è©¦å·¥å…·ï¼Œè¦æ±‚æ¸¬è©¦è¦†è“‹

#### é¢¨éšª 4: åŠŸèƒ½é‡è¤‡
- **æ©Ÿç‡**: ä¸­
- **å½±éŸ¿**: ä½
- **ç·©è§£**: æå–å‰å…ˆæª¢æŸ¥ç¾æœ‰åŠŸèƒ½

---

## æˆåŠŸæŒ‡æ¨™

### Phase 1 å®Œæˆæ¨™æº–
- âœ… async-state.ts åœ¨è‡³å°‘ 3 å€‹å…ƒä»¶ä¸­ä½¿ç”¨
- âœ… å¯©è¨ˆç³»çµ±è¨˜éŒ„é—œéµæ“ä½œ
- âœ… æ¸¬è©¦è¦†è“‹ç‡ > 80%

### Phase 2 å®Œæˆæ¨™æº–
- âœ… äº‹ä»¶ç³»çµ±æ”¯æ´è‡ªå‹•é‡è©¦
- âœ… æ¬Šé™æ§åˆ¶åœ¨æ‰€æœ‰è·¯ç”±ç”Ÿæ•ˆ
- âœ… Token è‡ªå‹•åˆ·æ–°ç„¡æ„ŸçŸ¥
- âœ… æ¸¬è©¦è¦†è“‹ç‡ > 85%

### Phase 3 å®Œæˆæ¨™æº–
- âœ… æ ¹æ“šå¯¦éš›éœ€æ±‚å®Œæˆé¸å®šåŠŸèƒ½
- âœ… æ‰€æœ‰æ–°åŠŸèƒ½æœ‰å®Œæ•´æ–‡æª”
- âœ… æ¸¬è©¦è¦†è“‹ç‡ä¿æŒ > 85%

---

## ä¸‹ä¸€æ­¥è¡Œå‹•

### ç«‹å³è¡Œå‹• (Today)
1. [ ] é–±è®€å®Œæ•´åˆ†ææ–‡æª”
2. [ ] å›ç­”é—œéµæ±ºç­–å•é¡Œ
3. [ ] ç¢ºå®šæå–å„ªå…ˆç´š
4. [ ] è¤‡è£½ async-state.ts (5 åˆ†é˜ä»»å‹™)

### æœ¬é€±è¡Œå‹• (This Week)
1. [ ] é–‹å§‹ Phase 1 æå–
2. [ ] è¨­ç½®æ¸¬è©¦ç’°å¢ƒ
3. [ ] å»ºç«‹æå–æª¢æŸ¥æ¸…å–®
4. [ ] å®šæœŸ Code Review

### ä¸‹é€±è¦åŠƒ (Next Week)
1. [ ] å®Œæˆ Phase 1
2. [ ] è©•ä¼°æˆæœ
3. [ ] è¦åŠƒ Phase 2
4. [ ] èª¿æ•´è¨ˆåŠƒ

---

## åƒè€ƒè³‡æº

- ğŸ“„ [å®Œæ•´åˆ†ææ–‡æª”](./OLD_SOURCE_FEATURE_EXTRACTION.md)
- ğŸ“„ [ç•¶å‰å°ˆæ¡ˆæ¶æ§‹](../ARCHITECTURE.md)
- ğŸ“„ [Result æ¨¡å¼æ–‡æª”](../../src/app/core/README.md)
- ğŸ“„ [æ¶æ§‹è¦å‰‡](../ARCHITECTURE_RULES.md)

---

## è¯çµ¡èˆ‡æ”¯æ´

å¦‚æœ‰ç–‘å•æˆ–éœ€è¦å”åŠ©ï¼š
1. æŸ¥é–±å®Œæ•´åˆ†ææ–‡æª”
2. åƒè€ƒç›¸é—œæ¶æ§‹æ–‡æª”
3. è¯çµ¡å°ˆæ¡ˆç¶­è­·è€…

---

<small>Generated with GitHub Copilot as directed by the development team</small>
