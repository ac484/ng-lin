# 最小可運行系統定義

## MVP（Minimum Viable Product）範圍

### 核心目標

建立一個可運行的 Event-Sourced Task Management 系統，驗證核心架構設計。

### 必備功能

#### 1. Event Store（事件存儲）

**最小實作**：
```typescript
interface MinimalEventStore {
  // 追加事件
  append(event: DomainEvent): Promise<void>;
  
  // 讀取事件流
  getEvents(aggregateId: string): Promise<DomainEvent[]>;
}
```

**儲存方案**：
- 選項 A：IndexedDB（本地優先）
- 選項 B：Firebase Realtime Database（雲端優先）

**不包含**：
- ❌ Snapshot 快照
- ❌ Event Bus 訂閱
- ❌ 複雜查詢

#### 2. Core Events（核心事件）

**Task 領域必備事件**：
```typescript
// 最小事件集（6 個）
TaskCreated       // 任務建立
TaskAssigned      // 任務指派
TaskStarted       // 任務開始
TaskCompleted     // 任務完成
TaskBlocked       // 任務阻擋
TaskCancelled     // 任務取消
```

**不包含**：
- ❌ TaskPriorityChanged
- ❌ TaskEstimateUpdated
- ❌ TaskCommentAdded
- ❌ TaskReassigned

#### 3. Projection（狀態投影）

**必備視圖**：
```typescript
// Task List View（任務列表）
interface TaskListProjection {
  tasks: Array<{
    id: string;
    title: string;
    status: TaskStatus;
    assignedTo?: string;
  }>;
}
```

**不包含**：
- ❌ Task Board View
- ❌ Task Why View
- ❌ Task Timeline View

#### 4. UI Components（介面組件）

**最小 UI**：
```
1. Task List（任務列表）
   - 顯示所有任務
   - 顯示狀態標籤
   
2. Task Create Form（建立表單）
   - 輸入標題
   - 指派給誰（可選）
   
3. Task Detail（任務詳情）
   - 顯示任務資訊
   - Start / Complete / Block 按鈕
```

**不包含**：
- ❌ 拖拉排序
- ❌ 批次操作
- ❌ 進階篩選
- ❌ 搜尋功能

## 架構層次範圍

### Core 層（必備）

```
src/app/core/
├── foundation/
│   ├── identity.ts      // UUID 生成
│   └── time.ts          // 時間服務
├── events/
│   └── domain-event.ts  // 事件基礎類型
└── result/
    └── result.ts        // Result<T, E> 類型
```

**不包含**：
- ❌ Policy Engine
- ❌ Authorization
- ❌ Audit Trail

### Infrastructure 層（簡化）

```
src/app/infrastructure/
├── event-store/
│   └── indexeddb-event-store.ts  // IndexedDB 實作
└── providers.ts                   // DI 設定
```

**不包含**：
- ❌ Firebase 整合
- ❌ Supabase 整合
- ❌ 多租戶支援

### Feature 層（Task 領域）

```
src/app/features/task/
├── events/
│   ├── task-created.event.ts
│   ├── task-assigned.event.ts
│   ├── task-started.event.ts
│   ├── task-completed.event.ts
│   ├── task-blocked.event.ts
│   └── task-cancelled.event.ts
├── projections/
│   └── task-list.projection.ts
├── commands/
│   ├── create-task.command.ts
│   ├── assign-task.command.ts
│   ├── start-task.command.ts
│   ├── complete-task.command.ts
│   └── block-task.command.ts
└── ui/
    ├── task-list/
    ├── task-create/
    └── task-detail/
```

**不包含**：
- ❌ Decisions 層
- ❌ Process 層
- ❌ Models 層（複雜讀模型）

### UI 層（最簡化）

```
src/app/pages/
└── tasks/
    └── tasks.component.ts  // 單頁應用
```

**不包含**：
- ❌ 多頁面路由
- ❌ 進階佈局
- ❌ 響應式設計（桌面優先）

## 技術選型（最小化）

### 必備套件

```json
{
  "dependencies": {
    "@angular/core": "^20.0.0",
    "@angular/common": "^20.0.0",
    "@angular/platform-browser": "^20.0.0",
    "rxjs": "^7.8.0"
  }
}
```

**不包含**：
- ❌ ng-zorro-antd（使用原生 HTML）
- ❌ @ngrx/store（使用 Signals）
- ❌ xstate
- ❌ @delon/*

### 狀態管理

```typescript
// 使用 Angular Signals
const tasks = signal<Task[]>([]);

// 使用 RxJS 處理事件流
const events$ = new Subject<DomainEvent>();
```

**不包含**：
- ❌ NgRx
- ❌ Akita
- ❌ 複雜狀態機

## 開發流程

### Phase 1: 基礎設施（1 週）

**目標**：建立 Event Store 和基礎類型

**交付**：
- [x] DomainEvent 類型定義
- [x] IndexedDB Event Store 實作
- [x] UUID / Time 服務

**驗證**：
- 可以 append 事件
- 可以 getEvents 讀取事件流

### Phase 2: Task 事件與投影（1 週）

**目標**：實作核心 Task 事件和 List View

**交付**：
- [x] 6 個核心事件定義
- [x] TaskListProjection 實作
- [x] 事件 → Projection 邏輯

**驗證**：
- 事件可以正確重播
- TaskListProjection 正確更新

### Phase 3: UI 基本功能（1 週）

**目標**：建立可用的介面

**交付**：
- [x] Task List 組件
- [x] Task Create Form
- [x] Task Detail View

**驗證**：
- 可以建立任務
- 可以變更狀態
- 可以查看列表

### Phase 4: 整合與測試（1 週）

**目標**：端對端整合

**交付**：
- [x] 完整使用者流程
- [x] 基本測試覆蓋

**驗證**：
- 建立 → 指派 → 開始 → 完成流程正常
- 事件正確記錄到 Event Store
- Projection 正確更新

## 成功標準

### 功能性

- [x] 可以建立任務
- [x] 可以指派任務
- [x] 可以開始任務
- [x] 可以完成任務
- [x] 可以阻擋任務
- [x] 可以取消任務
- [x] 可以查看任務列表
- [x] 任務狀態正確顯示

### 技術性

- [x] 事件正確存儲到 IndexedDB
- [x] 事件可以重播
- [x] Projection 正確重建
- [x] 無明顯效能問題（< 100ms 響應）
- [x] 無 Memory Leak

### 可驗證性

- [x] 開啟 IndexedDB，可以看到事件記錄
- [x] 重新載入頁面，狀態正確恢復
- [x] 手動刪除 IndexedDB，系統可以重新開始

## 不包含的功能（V2+）

以下功能明確排除在 MVP 之外：

### 進階功能
- ❌ Task 優先級管理
- ❌ Task 估算與追蹤
- ❌ Task 評論與討論
- ❌ Task 附件上傳
- ❌ Task 標籤與分類

### 協作功能
- ❌ 多人即時協作
- ❌ 通知與提醒
- ❌ 權限管理
- ❌ 審核流程

### 視覺化
- ❌ Board View（看板）
- ❌ Why View（因果鏈）
- ❌ Timeline View（時間軸）
- ❌ Gantt Chart

### 整合功能
- ❌ Work Package 整合
- ❌ Contract 整合
- ❌ 財務請款
- ❌ 報表匯出

### 平台功能
- ❌ User 管理
- ❌ Organization 管理
- ❌ Team 管理
- ❌ 多租戶

### 效能優化
- ❌ Snapshot 快照
- ❌ Event Bus
- ❌ CQRS 分離存儲
- ❌ 快取機制

## 程式碼規模預估

```
檔案數量：
- Core: 5-8 files
- Infrastructure: 3-5 files
- Task Events: 6 files
- Task Projection: 1 file
- Task Commands: 5 files
- UI Components: 3 files
總計：約 25-30 files

程式碼行數：
- Core: ~200 lines
- Infrastructure: ~300 lines
- Task Domain: ~400 lines
- UI: ~500 lines
總計：約 1,400-1,600 lines
```

## 時程規劃

```
Week 1: 基礎設施
  Day 1-2: Event Store 實作
  Day 3-4: 核心類型定義
  Day 5: 整合測試

Week 2: Task 領域
  Day 1-2: 事件定義
  Day 3-4: Projection 實作
  Day 5: 單元測試

Week 3: UI 開發
  Day 1-2: Task List
  Day 3: Task Create
  Day 4: Task Detail
  Day 5: 樣式調整

Week 4: 整合與測試
  Day 1-2: E2E 測試
  Day 3-4: Bug 修復
  Day 5: 文件與 Demo
```

## 部署方案

**開發環境**：
- 本地開發：`ng serve`
- 資料：IndexedDB（瀏覽器本地）

**展示環境**：
- 靜態部署：GitHub Pages / Netlify
- 資料：仍使用 IndexedDB（每個瀏覽器獨立）

**不包含**：
- ❌ 正式環境部署
- ❌ 雲端資料庫
- ❌ CI/CD 流程
- ❌ 監控與日誌

## 風險與限制

### 已知限制

1. **資料只存在瀏覽器**
   - 清除瀏覽器資料會遺失
   - 不同瀏覽器資料不同步

2. **無多人協作**
   - 只能單人使用
   - 無即時更新

3. **效能未優化**
   - 事件多時可能變慢
   - 無快照機制

### 風險緩解

1. **定期匯出資料**
   - 提供 Export JSON 功能
   - 可手動備份

2. **明確告知使用者**
   - 標示為 Demo / Prototype
   - 說明資料限制

---

**版本**: 1.0  
**更新日期**: 2024-12-31  
**維護者**: Architecture Team
