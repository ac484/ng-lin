# 名詞與語言邊界定義

## Ubiquitous Language（統一語言）

本專案採用 Domain-Driven Design (DDD) 的統一語言原則，確保技術實作與業務概念一致。

### 核心領域術語

#### Event Sourcing 層

**Event（事件）**
- 定義：已發生的業務事實，不可變更
- 特性：Immutable、Traceable、Permanent
- 範例：TaskCreated, TaskCompleted, OrderPlaced

**Event Store（事件存儲）**
- 定義：所有事件的唯一真相來源
- 職責：追加事件、查詢事件流、維護因果鏈
- 實作：Firebase/Supabase/IndexedDB

**Causality（因果關係）**
- 定義：事件之間的前驅後繼關係
- 表達：causedBy 欄位記錄前驅事件 ID
- 價值：完整追溯、責任歸屬、流程分析

**Projection（投影）**
- 定義：從事件流重建的狀態視圖
- 特性：Pure Function、可重複計算、多視圖
- 範例：TaskListView, TaskBoardView, TaskWhyView

#### Task 領域

**Task（任務）**
- 定義：需要人類決策或操作的待辦項目
- 本質：Event Stream 的派生視圖
- 狀態：Pending, Assigned, InProgress, Blocked, Completed

**Process（流程）**
- 定義：標準化的業務流程定義
- 職責：定義標準步驟、建議下一步行動
- 特性：可重複、可變體、可優化

**Work Package（工作包）**
- 定義：實際執行的工作包
- 層次：Contract → Work Package → Task
- 特性：規劃階段可調整

#### Platform 層

**User（用戶）**
- 定義：系統使用者
- 角色：建立者、執行者、審核者

**Organization（組織）**
- 定義：多租戶的組織單位
- 職責：資源隔離、權限邊界

**Team（團隊）**
- 定義：組織內的執行單元
- 關係：User ∈ Team ∈ Organization

**Collaborator（協作者）**
- 定義：跨組織或外部協作者
- 特性：受邀、有限權限、可追溯

**Bot（機器人）**
- 定義：自動化執行者
- 用途：自動任務、定時流程、通知

### 架構層次術語

#### Core 層

**Policy（策略）**
- 定義：集中化的授權決策引擎
- 職責：判斷權限、驗證規則
- 原則：Feature 不自行判斷權限

**Contract（契約）**
- 定義：跨邊界的接口定義
- 範圍：DTO、Event Schema、API
- 原則：Feature 間只能透過 Contract 溝通

**Result（結果）**
- 定義：錯誤處理的統一模式
- 類型：Result.Ok / Result.Err
- 原則：禁止 throw Error、禁止 null

**Audit（審計）**
- 定義：系統行為的完整記錄
- 來源：Domain Events
- 價值：合規、追溯、分析

#### Feature 層

**Domain（領域）**
- 定義：業務邏輯的核心
- 限制：不知道 UI、不知道 Infrastructure
- 原則：Pure Function、無副作用

**Application（應用）**
- 定義：業務流程的編排層
- 職責：調用 Policy、組合 Domain、呼叫 Repository
- 原則：薄層、無業務邏輯

**Saga / Process Manager**
- 定義：跨 Aggregate 的長流程協調
- 職責：監聽事件、觸發補償、維護狀態
- 原則：不擁有資料、不寫業務規則

**Capability（能力）**
- 定義：平台提供的可選功能
- 特性：被動、可插拔、不影響 Domain
- 範例：通知、搜尋、匯出

#### Infrastructure 層

**Repository（倉儲）**
- 定義：Aggregate 的持久化接口
- 實作：Firebase、Supabase、IndexedDB
- 原則：實作 Core 定義的接口

**Event Bus（事件匯流排）**
- 定義：事件發布訂閱機制
- 職責：publish、subscribe、路由
- 實作：RxJS Subject / Firebase Realtime

**Adapter（適配器）**
- 定義：外部系統的抽象層
- 職責：轉換協議、處理錯誤、重試
- 原則：不洩漏外部概念到 Domain

### CQRS 術語

**Command（命令）**
- 定義：表達意圖的操作請求
- 範例：CreateTask, CompleteTask, AssignTask
- 結果：產生 Event 或 Error

**Query（查詢）**
- 定義：無副作用的資料查詢
- 來源：Read Model
- 原則：不改變狀態、不產生事件

**Read Model（讀模型）**
- 定義：優化查詢的預先計算視圖
- 更新：由 Event Handler 維護
- 特性：可重建、可多種格式

**Write Model（寫模型）**
- 定義：Event Store 本身
- 操作：只能 Append
- 原則：Immutable、Complete

## 語言邊界（Bounded Context）

### Task Domain（任務領域）

**邊界內**：
- Task、Event、Projection、Decision、Process
- 任務生命週期、狀態轉換、協作機制

**邊界外**：
- Platform 實體（只能引用，不能修改）
- Infrastructure 細節（只能透過接口）

**交互方式**：
- 發布 Domain Event
- 接收 Platform 引用（userId, orgId）

### Platform Domain（平台領域）

**邊界內**：
- User、Organization、Team、Collaborator、Bot
- 多租戶、權限、組織結構

**邊界外**：
- Task 業務邏輯（不關心任務細節）
- Infrastructure 實作

**交互方式**：
- 提供身份識別
- 回應權限查詢

### Bounded Context 溝通規則

1. **Anti-Corruption Layer（防腐層）**
   - 外部概念不直接進入 Domain
   - 透過 Adapter 轉換為 Domain 語言

2. **Event-Driven Integration**
   - 跨 Context 透過 Event 溝通
   - 不直接呼叫對方的 Domain

3. **Shared Kernel（共享核心）**
   - Core 層的 Contract、Policy、Result
   - 全域共享，但版本嚴格管理

## 禁用術語（避免歧義）

❌ **狀態**（State）
- 問題：容易與資料庫狀態混淆
- 替代：View、Projection、Snapshot

❌ **儲存**（Save）
- 問題：暗示修改現有資料
- 替代：Append Event、Commit

❌ **刪除**（Delete）
- 問題：違反 Event Sourcing 不可變原則
- 替代：Mark as Cancelled、Soft Delete Event

❌ **更新**（Update）
- 問題：暗示修改現有記錄
- 替代：Apply Event、Transition State

❌ **同步**（Sync）
- 問題：與 async 混淆
- 替代：Replay、Reconcile、Converge

## 術語使用規範

### 程式碼命名

```typescript
// ✅ 正確
TaskCreatedEvent
CreateTaskCommand
TaskListProjection
CompleteTaskDecision

// ❌ 錯誤
TaskCreateEvent        // 應該是過去式
CreateTaskEvent        // Command 不是 Event
TaskListState          // 應該是 Projection
CompleteTaskValidator  // 應該是 Decision
```

### 文件撰寫

```markdown
✅ 正確：
- 「當 TaskCompleted 事件發生時」
- 「Projection 從事件流重建視圖」
- 「Domain 層不知道 Infrastructure」

❌ 錯誤：
- 「當任務完成時更新資料庫」
- 「從資料庫讀取任務狀態」
- 「Service 呼叫 DAO」
```

### 討論溝通

**業務討論**：
- 使用 Domain 術語（Task, Event, Process）
- 避免技術術語（Table, Column, API）

**技術討論**：
- 明確區分層次（Domain vs Infrastructure）
- 使用統一的架構術語（Projection, Saga）

## 術語演進

### 版本管理

當術語需要調整時：
1. 在此文件記錄變更
2. 更新所有相關文件
3. 標記舊術語為 Deprecated
4. 提供遷移期（至少一個 Sprint）

### 新增術語流程

1. 確認沒有現有術語可用
2. 定義清晰的範圍和職責
3. 在此文件新增條目
4. 團隊 Review 通過
5. 開始使用

---

**版本**: 1.0  
**更新日期**: 2024-12-31  
**維護者**: Architecture Team
