# GitHub Copilot Agent è‡ªå‹•è§¸ç™¼è¦å‰‡
# å„ªå…ˆç´š: ğŸ¯ é«˜ - å®šç¾© Agent ä½•æ™‚è‡ªå‹•ä½¿ç”¨ MCP å·¥å…·
# é©ç”¨ç’°å¢ƒ: GitHub Copilot Chat (Web)

triggers:
  
  # ==========================================
  # ğŸ¯ Context7 MCP æ™ºæ…§è§¸ç™¼è¦å‰‡
  # ==========================================
  
  context7_search:
    enabled: true
    description: "ç•¶é‡åˆ°ä¸ç¢ºå®šçš„ APIã€ç‰ˆæœ¬ã€èªæ³•æ™‚è‡ªå‹•æŸ¥è­‰"
    
    # æƒ…å¢ƒ 1: æœ‰çµ•å°æŠŠæ¡ â†’ ä¸è§¸ç™¼ Context7
    skip_conditions:
      - name: "ç¢ºå®šçš„ API ç°½å"
        patterns:
          - "Angular æ ¸å¿ƒ API (Component, Injectable, NgModule)"
          - "TypeScript åŸºç¤èªæ³•"
          - "JavaScript åŸç”Ÿæ–¹æ³•"
        confidence_level: "high"
        action: "ç›´æ¥é–‹ç™¼ï¼Œç„¡éœ€æŸ¥è­‰"
        
      - name: "ç†Ÿæ‚‰çš„å¥—ä»¶"
        packages:
          - "@angular/core"
          - "@angular/common"
          - "rxjs/operators"
          - "typescript"
        version_check: false
        action: "ä½¿ç”¨å·²çŸ¥çŸ¥è­˜åº«"
        
    # æƒ…å¢ƒ 2: æ²’æœ‰çµ•å°æŠŠæ¡ â†’ å¿…é ˆè§¸ç™¼ Context7
    auto_trigger_conditions:
      
      # æ¢ä»¶ 1: ä¸ç¢ºå®šå‡½å¼åƒæ•¸
      - name: "API åƒæ•¸ä¸ç¢ºå®š"
        trigger_keywords:
          - "function signature"
          - "parameters order"
          - "arguments type"
          - "method overload"
        patterns:
          - '\.(\w+)\('                      # ä»»ä½•å‡½å¼å‘¼å«
          - 'new \w+\('                      # å»ºæ§‹å­
        confidence_threshold: 0.7            # ä¿¡å¿ƒåº¦ < 70% å°±è§¸ç™¼
        mcp_action:
          tool: "context7"
          query_template: "æŸ¥è©¢ {package_name} {api_name} çš„æ­£ç¢ºåƒæ•¸é †åºå’Œå‹åˆ¥å®šç¾©"
          sources:
            - "official_docs"
            - "npm_registry"
            - "typescript_definitions"
            
      # æ¢ä»¶ 2: ç‰ˆæœ¬å·®ç•°ç–‘æ…®
      - name: "ç‰ˆæœ¬ç›¸å®¹æ€§å•é¡Œ"
        trigger_keywords:
          - "version"
          - "deprecated"
          - "breaking change"
          - "migration"
          - "upgrade"
        patterns:
          - '@angular/.*@\d+'                # Angular ç‰ˆæœ¬è™Ÿ
          - 'ng-zorro-antd.*\d+'             # NG-ZORRO ç‰ˆæœ¬
        mcp_action:
          tool: "context7"
          query_template: "é©—è­‰ {package_name}@{version} çš„ API ç›¸å®¹æ€§å’Œè®Šæ›´è¨˜éŒ„"
          sources:
            - "changelog"
            - "migration_guide"
            - "github_releases"
            
      # æ¢ä»¶ 3: æ–°æ¡†æ¶ç‰¹æ€§
      - name: "æ–°èªæ³•æˆ–ç‰¹æ€§"
        trigger_keywords:
          - "Angular 20"
          - "Angular 19"
          - "@if"
          - "@for"
          - "@switch"
          - "@defer"
          - "control flow"
          - "signal"
          - "inject()"
        confidence_threshold: 0.8
        mcp_action:
          tool: "context7"
          query_template: "æŸ¥è©¢ Angular {version} {feature_name} çš„å®˜æ–¹ç”¨æ³•å’Œæœ€ä½³å¯¦è¸"
          sources:
            - "angular.dev"
            - "official_blog"
            - "github_examples"
            
      # æ¢ä»¶ 4: ç¬¬ä¸‰æ–¹å¥—ä»¶ API
      - name: "ä¸ç†Ÿæ‚‰çš„å¥—ä»¶"
        trigger_packages:
          - "ng-zorro-antd"                  # NG-ZORRO API æŸ¥è­‰
          - "@delon/*"                       # NG-ALAIN API æŸ¥è­‰
          - "ngx-*"                          # ä»»ä½• ngx- å¥—ä»¶
          - "primeng"
          - "rxjs"                           # RxJS æ“ä½œç¬¦
        exclude_common:                      # æ’é™¤å¸¸ç”¨çš„
          - "map"
          - "filter"
          - "tap"
          - "catchError"
        mcp_action:
          tool: "context7"
          query_template: "æŸ¥è©¢ {package_name} {component_or_api} çš„å®Œæ•´ä½¿ç”¨ç¯„ä¾‹å’Œ API æ–‡ä»¶"
          sources:
            - "package_docs"
            - "npm_readme"
            - "stackblitz_examples"
            
      # æ¢ä»¶ 5: éŒ¯èª¤è¨Šæ¯å‡ºç¾
      - name: "ç·¨è­¯æˆ–åŸ·è¡ŒéŒ¯èª¤"
        trigger_patterns:
          - 'Error:'
          - 'TypeError:'
          - 'NG\d{4}:'                       # Angular éŒ¯èª¤ä»£ç¢¼
          - 'Cannot find'
          - 'is not assignable'
        auto_execute: true                   # ğŸ”¥ è‡ªå‹•åŸ·è¡Œ
        mcp_action:
          tool: "context7"
          query_template: "æœå°‹éŒ¯èª¤ '{error_message}' çš„å®˜æ–¹è§£æ±ºæ–¹æ¡ˆå’Œæ ¹æœ¬åŸå› "
          sources:
            - "angular_errors"
            - "stackoverflow"
            - "github_issues"
            
      # æ¢ä»¶ 6: TypeScript å‹åˆ¥å•é¡Œ
      - name: "å‹åˆ¥å®šç¾©ä¸æ˜ç¢º"
        trigger_keywords:
          - "type"
          - "interface"
          - "generic"
          - "Union"
          - "as"
          - "unknown"
        patterns:
          - '<[A-Z]\w*>'                     # æ³›å‹
          - ':\s*\w+\s*\|'                   # Union Type
        mcp_action:
          tool: "context7"
          query_template: "æŸ¥è©¢ {type_name} çš„æ­£ç¢ºå‹åˆ¥å®šç¾©å’Œä½¿ç”¨æ–¹å¼"
          sources:
            - "typescript_handbook"
            - "type_definitions"
  
  # ==========================================
  # ğŸ“ æª”æ¡ˆæ“ä½œè‡ªå‹•è§¸ç™¼
  # ==========================================
  
  on_file_save:
    enabled: true
    file_patterns:
      - "**/*.ts"
      - "**/*.component.html"
      - "**/*.service.ts"
      - "**/*.module.ts"
      
    actions:
      - name: "èªæ³•æª¢æŸ¥"
        priority: 1
        steps:
          - "æª¢æŸ¥æ˜¯å¦ä½¿ç”¨ *ngIf, *ngFor (èˆŠèªæ³•)"
          - "å¦‚æœæ˜¯ â†’ è‡ªå‹•å»ºè­°æ”¹ç‚º @if, @for"
          
      - name: "Import å„ªåŒ–"
        priority: 2
        conditions:
          - "æœ‰æœªä½¿ç”¨çš„ import"
          - "import é †åºæ··äº‚"
        steps:
          - "ç§»é™¤æœªä½¿ç”¨çš„ import"
          - "æŒ‰ç…§ Angular Style Guide æ’åº"
          
  # ==========================================
  # ğŸ’¬ é—œéµå­—è§¸ç™¼
  # ==========================================
  
  on_keyword:
    enabled: true
    
    keywords:
      - trigger: "// TODO:"
        mcp_tools: ["context7"]
        action:
          - "åˆ†æ TODO å…§å®¹"
          - "å¦‚æœæ¶‰åŠæ–° API â†’ ä½¿ç”¨ Context7 æŸ¥è­‰"
          - "ç”¢ç”Ÿå¯¦ä½œå»ºè­°"
          
      - trigger: "// FIXME:"
        mcp_tools: ["context7"]
        action:
          - "åˆ†æå•é¡Œ"
          - "ä½¿ç”¨ Context7 æœå°‹è§£æ±ºæ–¹æ¡ˆ"
          - "æä¾›ä¿®å¾©æ­¥é©Ÿ"
          
      - trigger: "// HELP:"
        mcp_tools: ["context7"]
        auto_execute: true
        action:
          - "ç«‹å³ä½¿ç”¨ Context7 æœå°‹ç›¸é—œæ–‡ä»¶"
          - "æä¾›è©³ç´°è§£ç­”"
          
  # ==========================================
  # ğŸ” ç¨‹å¼ç¢¼è£œå…¨è§¸ç™¼
  # ==========================================
  
  on_code_completion:
    enabled: true
    
    conditions:
      # ç•¶è¼¸å…¥å¥—ä»¶åç¨±æ™‚
      - trigger_pattern: 'import .* from ["''](@angular|ng-zorro|@delon)'
        mcp_action:
          tool: "context7"
          action: "é©—è­‰ import è·¯å¾‘æ­£ç¢ºæ€§"
          
      # ç•¶ä½¿ç”¨å…ƒä»¶é¸æ“‡å™¨æ™‚
      - trigger_pattern: '<nz-|<st-'
        mcp_action:
          tool: "context7"
          action: "æŸ¥è©¢å…ƒä»¶å®Œæ•´å±¬æ€§åˆ—è¡¨"
          
      # ç•¶ä½¿ç”¨ RxJS æ“ä½œç¬¦æ™‚  
      - trigger_pattern: '\.pipe\('
        mcp_action:
          tool: "context7"
          action: "å»ºè­°é©åˆçš„æ“ä½œç¬¦çµ„åˆ"
          
  # ==========================================
  # ğŸš¨ éŒ¯èª¤è‡ªå‹•è™•ç†
  # ==========================================
  
  on_error:
    enabled: true
    auto_execute: true                       # ğŸ”¥ é‡åˆ°éŒ¯èª¤è‡ªå‹•åŸ·è¡Œ
    
    error_patterns:
      - pattern: "NG0303"                    # æœªçŸ¥å±¬æ€§
        mcp_action:
          tool: "context7"
          query: "Angular æœªçŸ¥å±¬æ€§éŒ¯èª¤è§£æ±ºæ–¹æ¡ˆ"
          
      - pattern: "NG2700"                    # æ§åˆ¶æµèªæ³•éŒ¯èª¤
        mcp_action:
          tool: "context7"
          query: "Angular 20 æ§åˆ¶æµèªæ³•æ­£ç¢ºç”¨æ³•"
          
      - pattern: "Cannot find module"
        mcp_action:
          tool: "context7"
          query: "å¥—ä»¶å®‰è£å’Œè·¯å¾‘é…ç½®"
          
  # ==========================================
  # ğŸ¨ UI å…ƒä»¶ä½¿ç”¨è§¸ç™¼
  # ==========================================
  
  on_ui_component:
    enabled: true
    
    components:
      - name: "nz-table"
        trigger_on_use: true
        mcp_action:
          tool: "context7"
          query: "NG-ZORRO nz-table å®Œæ•´ API å’Œä½¿ç”¨ç¯„ä¾‹"
          
      - name: "nz-form"
        trigger_on_use: true
        mcp_action:
          tool: "context7"
          query: "NG-ZORRO è¡¨å–®é©—è­‰å’ŒéŸ¿æ‡‰å¼è¡¨å–®æœ€ä½³å¯¦è¸"
          
      - name: "st-"
        trigger_on_use: true
        mcp_action:
          tool: "context7"
          query: "NG-ALAIN simple-table é…ç½®å’Œè‡ªè¨‚"

# ==========================================
# âš™ï¸ å…¨åŸŸè¨­å®š
# ==========================================

settings:
  # Context7 æŸ¥è©¢å„ªå…ˆç´š
  context7_priority: "high"
  
  # ä¿¡å¿ƒåº¦é–¾å€¼ (ä½æ–¼æ­¤å€¼è‡ªå‹•è§¸ç™¼ Context7)
  confidence_threshold: 0.75
  
  # å¿«å–è¨­å®š
  cache:
    enabled: true
    ttl: 3600                                # å¿«å– 1 å°æ™‚
    
  # é€Ÿç‡é™åˆ¶
  rate_limit:
    max_queries_per_minute: 10
    
  # æŸ¥è©¢ä¾†æºå„ªå…ˆé †åº
  source_priority:
    - "official_docs"                        # å®˜æ–¹æ–‡ä»¶æœ€å„ªå…ˆ
    - "npm_registry"                         # NPM å®˜æ–¹é é¢
    - "github_repo"                          # GitHub å€‰åº«
    - "stackoverflow"                        # Stack Overflow
    - "blog_posts"                           # æŠ€è¡“éƒ¨è½æ ¼ (æœ€å¾Œ)
